# WeDraw åŸºç¡€è®¾æ–½

è¿™æ˜¯ WeDraw å¾®æœåŠ¡æ¶æ„çš„åŸºç¡€è®¾æ–½é…ç½®ï¼ŒåŒ…å«æ•°æ®åº“ã€ç¼“å­˜ã€åå‘ä»£ç†ã€ç›‘æ§ç­‰æ ¸å¿ƒæœåŠ¡ã€‚

## ğŸ—ï¸ æ¶æ„æ¦‚è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Nginx (åå‘ä»£ç†)                      â”‚
â”‚                     Port: 80, 443                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     â”‚           å¾®æœåŠ¡å±‚                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ API Gateway â”‚   â”‚   â”‚ User Center â”‚   â”‚   WeWork    â”‚   â”‚
â”‚  â”‚   :3000     â”‚   â”‚   â”‚    :3001    â”‚   â”‚    :3002    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                     â”‚                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ MiniProgram â”‚   â”‚   â”‚   WeChat    â”‚   â”‚ Points Mall â”‚   â”‚
â”‚  â”‚   :3003     â”‚   â”‚   â”‚    :3004    â”‚   â”‚    :3005    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                     â”‚                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚                                       â”‚
â”‚  â”‚Message Centerâ”‚  â”‚                                       â”‚
â”‚  â”‚   :3006     â”‚   â”‚                                       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     â”‚          åŸºç¡€è®¾æ–½å±‚                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚    MySQL    â”‚   â”‚   â”‚    Redis    â”‚   â”‚ Prometheus  â”‚   â”‚
â”‚  â”‚   :3306     â”‚   â”‚   â”‚    :6379    â”‚   â”‚    :9090    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                     â”‚                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚  â”‚  Grafana    â”‚   â”‚   â”‚ Redis Cmd   â”‚                     â”‚
â”‚  â”‚   :3000     â”‚   â”‚   â”‚    :8081    â”‚                     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“¦ æœåŠ¡ç»„ä»¶

### æ ¸å¿ƒæœåŠ¡
- **MySQL 8.0**: ä¸»æ•°æ®åº“ï¼Œæ”¯æŒå¤šä¸ªå¾®æœåŠ¡æ•°æ®åº“
- **Redis 7.0**: ç¼“å­˜å’Œä¼šè¯å­˜å‚¨
- **Nginx**: åå‘ä»£ç†å’Œè´Ÿè½½å‡è¡¡

### ç®¡ç†å·¥å…·
- **phpMyAdmin**: MySQL æ•°æ®åº“ç®¡ç†ç•Œé¢
- **Redis Commander**: Redis ç¼“å­˜ç®¡ç†ç•Œé¢

### ç›‘æ§æœåŠ¡
- **Prometheus**: ç›‘æ§æ•°æ®æ”¶é›†
- **Grafana**: ç›‘æ§æ•°æ®å¯è§†åŒ–

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚
- Docker 20.10+
- Docker Compose 2.0+
- è‡³å°‘ 4GB å¯ç”¨å†…å­˜
- è‡³å°‘ 10GB å¯ç”¨ç£ç›˜ç©ºé—´

### å¯åŠ¨æœåŠ¡

#### Windows
```bash
# åŒå‡»è¿è¡Œæˆ–åœ¨å‘½ä»¤è¡Œæ‰§è¡Œ
start.bat
```

#### Linux/macOS
```bash
# æ·»åŠ æ‰§è¡Œæƒé™
chmod +x start.sh

# å¯åŠ¨æœåŠ¡
./start.sh
```

#### æ‰‹åŠ¨å¯åŠ¨
```bash
# å¯åŠ¨æ‰€æœ‰æœåŠ¡
docker-compose up -d

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker-compose ps

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f
```

## ğŸŒ è®¿é—®åœ°å€

| æœåŠ¡ | åœ°å€ | è¯´æ˜ |
|------|------|------|
| ç®¡ç†é¢æ¿ | http://localhost | ç»Ÿä¸€ç®¡ç†å…¥å£ |
| APIç½‘å…³ | http://localhost/api | å¾®æœåŠ¡APIå…¥å£ |
| phpMyAdmin | http://localhost/phpmyadmin | æ•°æ®åº“ç®¡ç† |
| Redis Commander | http://localhost/redis | Redisç®¡ç† |
| Grafana | http://localhost/grafana | ç›‘æ§é¢æ¿ |
| Prometheus | http://localhost/prometheus | ç›‘æ§æ•°æ® |

## ğŸ” é»˜è®¤è´¦å·

### MySQL
- **Rootç”¨æˆ·**: `root` / `wedraw_root_123`
- **æœåŠ¡ç”¨æˆ·**: è§æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬

### Redis
- **æ— å¯†ç **: å¼€å‘ç¯å¢ƒé»˜è®¤æ— å¯†ç 

### Grafana
- **ç®¡ç†å‘˜**: `admin` / `wedraw_admin_123`

### phpMyAdmin
- **ä½¿ç”¨MySQLè´¦å·ç™»å½•**

## ğŸ“ ç›®å½•ç»“æ„

```
infrastructure/
â”œâ”€â”€ docker-compose.yml          # Docker Compose é…ç½®
â”œâ”€â”€ .env                        # ç¯å¢ƒå˜é‡é…ç½®
â”œâ”€â”€ start.sh                    # Linux/macOS å¯åŠ¨è„šæœ¬
â”œâ”€â”€ start.bat                   # Windows å¯åŠ¨è„šæœ¬
â”œâ”€â”€ README.md                   # è¯´æ˜æ–‡æ¡£
â”œâ”€â”€ database/                   # MySQL é…ç½®
â”‚   â”œâ”€â”€ conf/
â”‚   â”‚   â””â”€â”€ my.cnf             # MySQL é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ init/
â”‚   â”‚   â””â”€â”€ 01-create-databases.sql  # æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬
â”‚   â”œâ”€â”€ data/                  # æ•°æ®æ–‡ä»¶ç›®å½•
â”‚   â””â”€â”€ logs/                  # æ—¥å¿—æ–‡ä»¶ç›®å½•
â”œâ”€â”€ redis/                     # Redis é…ç½®
â”‚   â”œâ”€â”€ conf/
â”‚   â”‚   â””â”€â”€ redis.conf         # Redis é…ç½®æ–‡ä»¶
â”‚   â””â”€â”€ data/                  # æ•°æ®æ–‡ä»¶ç›®å½•
â”œâ”€â”€ nginx/                     # Nginx é…ç½®
â”‚   â”œâ”€â”€ conf/
â”‚   â”‚   â”œâ”€â”€ nginx.conf         # ä¸»é…ç½®æ–‡ä»¶
â”‚   â”‚   â””â”€â”€ conf.d/
â”‚   â”‚       â”œâ”€â”€ api-gateway.conf    # APIç½‘å…³é…ç½®
â”‚   â”‚       â””â”€â”€ admin.conf          # ç®¡ç†ç•Œé¢é…ç½®
â”‚   â””â”€â”€ logs/                  # æ—¥å¿—æ–‡ä»¶ç›®å½•
â”œâ”€â”€ prometheus/                # Prometheus é…ç½®
â”‚   â””â”€â”€ data/                  # æ•°æ®æ–‡ä»¶ç›®å½•
â””â”€â”€ grafana/                   # Grafana é…ç½®
    â””â”€â”€ data/                  # æ•°æ®æ–‡ä»¶ç›®å½•
```

## ğŸ”§ ç®¡ç†å‘½ä»¤

### æœåŠ¡ç®¡ç†
```bash
# å¯åŠ¨æ‰€æœ‰æœåŠ¡
docker-compose up -d

# åœæ­¢æ‰€æœ‰æœåŠ¡
docker-compose down

# é‡å¯æœåŠ¡
docker-compose restart [service_name]

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker-compose ps

# æŸ¥çœ‹æœåŠ¡æ—¥å¿—
docker-compose logs -f [service_name]

# è¿›å…¥å®¹å™¨
docker-compose exec [service_name] bash
```

### æ•°æ®åº“ç®¡ç†
```bash
# è¿æ¥ MySQL
docker-compose exec mysql mysql -u root -p

# å¤‡ä»½æ•°æ®åº“
docker-compose exec mysql mysqldump -u root -p --all-databases > backup.sql

# æ¢å¤æ•°æ®åº“
docker-compose exec -T mysql mysql -u root -p < backup.sql
```

### Redis ç®¡ç†
```bash
# è¿æ¥ Redis
docker-compose exec redis redis-cli

# æŸ¥çœ‹ Redis ä¿¡æ¯
docker-compose exec redis redis-cli info

# æ¸…ç©º Redis
docker-compose exec redis redis-cli flushall
```

## ğŸ“Š ç›‘æ§é…ç½®

### Prometheus ç›‘æ§ç›®æ ‡
- MySQL Exporter
- Redis Exporter
- Node Exporter
- å„å¾®æœåŠ¡å¥åº·æ£€æŸ¥

### Grafana ä»ªè¡¨æ¿
- ç³»ç»Ÿèµ„æºç›‘æ§
- æ•°æ®åº“æ€§èƒ½ç›‘æ§
- Redis æ€§èƒ½ç›‘æ§
- å¾®æœåŠ¡çŠ¶æ€ç›‘æ§

## ğŸ”’ å®‰å…¨é…ç½®

### ç½‘ç»œå®‰å…¨
- æœåŠ¡é—´é€šä¿¡ä½¿ç”¨å†…éƒ¨ç½‘ç»œ
- åªæš´éœ²å¿…è¦çš„ç«¯å£
- ä½¿ç”¨å¼ºå¯†ç 

### æ•°æ®å®‰å…¨
- æ•°æ®åº“ç”¨æˆ·æƒé™æœ€å°åŒ–
- å®šæœŸå¤‡ä»½æ•°æ®
- æ•æ„Ÿä¿¡æ¯ä½¿ç”¨ç¯å¢ƒå˜é‡

## ğŸ› æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **ç«¯å£å†²çª**
   ```bash
   # æ£€æŸ¥ç«¯å£å ç”¨
   netstat -tulpn | grep :80
   
   # ä¿®æ”¹ docker-compose.yml ä¸­çš„ç«¯å£æ˜ å°„
   ```

2. **æƒé™é—®é¢˜**
   ```bash
   # Linux/macOS è®¾ç½®ç›®å½•æƒé™
   sudo chown -R $USER:$USER ./data
   ```

3. **å†…å­˜ä¸è¶³**
   ```bash
   # æ£€æŸ¥ç³»ç»Ÿèµ„æº
   docker system df
   docker system prune
   ```

4. **æœåŠ¡å¯åŠ¨å¤±è´¥**
   ```bash
   # æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
   docker-compose logs [service_name]
   
   # é‡æ–°æ„å»ºé•œåƒ
   docker-compose build --no-cache [service_name]
   ```

### å¥åº·æ£€æŸ¥
```bash
# æ£€æŸ¥æ‰€æœ‰æœåŠ¡å¥åº·çŠ¶æ€
curl http://localhost/health

# æ£€æŸ¥ MySQL
docker-compose exec mysql mysqladmin ping

# æ£€æŸ¥ Redis
docker-compose exec redis redis-cli ping
```

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### MySQL ä¼˜åŒ–
- è°ƒæ•´ `my.cnf` é…ç½®å‚æ•°
- å®šæœŸä¼˜åŒ–è¡¨ç»“æ„
- ç›‘æ§æ…¢æŸ¥è¯¢æ—¥å¿—

### Redis ä¼˜åŒ–
- é…ç½®åˆé€‚çš„å†…å­˜ç­–ç•¥
- ä½¿ç”¨ Redis é›†ç¾¤ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
- ç›‘æ§å†…å­˜ä½¿ç”¨æƒ…å†µ

### Nginx ä¼˜åŒ–
- å¯ç”¨ Gzip å‹ç¼©
- é…ç½®ç¼“å­˜ç­–ç•¥
- è°ƒæ•´å·¥ä½œè¿›ç¨‹æ•°

## ğŸ”„ å‡çº§æŒ‡å—

1. **å¤‡ä»½æ•°æ®**
   ```bash
   ./backup.sh
   ```

2. **åœæ­¢æœåŠ¡**
   ```bash
   docker-compose down
   ```

3. **æ›´æ–°é…ç½®**
   ```bash
   git pull origin main
   ```

4. **å¯åŠ¨æœåŠ¡**
   ```bash
   ./start.sh
   ```

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚é‡åˆ°é—®é¢˜ï¼Œè¯·ï¼š
1. æŸ¥çœ‹æœ¬æ–‡æ¡£çš„æ•…éšœæ’é™¤éƒ¨åˆ†
2. æ£€æŸ¥æœåŠ¡æ—¥å¿—
3. æäº¤ Issue åˆ°é¡¹ç›®ä»“åº“

---

**æ³¨æ„**: æ­¤é…ç½®é€‚ç”¨äºå¼€å‘å’Œæµ‹è¯•ç¯å¢ƒã€‚ç”Ÿäº§ç¯å¢ƒè¯·æ ¹æ®å®é™…éœ€æ±‚è°ƒæ•´å®‰å…¨é…ç½®ã€æ€§èƒ½å‚æ•°å’Œé«˜å¯ç”¨è®¾ç½®ã€‚