# WeDrawç§¯åˆ†å•†åŸåç«¯æœåŠ¡

## é¡¹ç›®ç®€ä»‹

WeDrawç§¯åˆ†å•†åŸæ˜¯ä¸€ä¸ªåŸºäºNode.jså’ŒExpressæ¡†æ¶å¼€å‘çš„ç§¯åˆ†å•†åŸåç«¯æœåŠ¡ï¼Œæä¾›å®Œæ•´çš„ç§¯åˆ†ç®¡ç†ã€å•†å“ç®¡ç†ã€è®¢å•å¤„ç†ã€ç”¨æˆ·ç®¡ç†ç­‰åŠŸèƒ½ã€‚

## ä¸»è¦åŠŸèƒ½

### ğŸ¯ æ ¸å¿ƒåŠŸèƒ½
- **ç”¨æˆ·ç®¡ç†** - ç”¨æˆ·æ³¨å†Œã€ç™»å½•ã€ä¿¡æ¯ç®¡ç†
- **ç§¯åˆ†ç³»ç»Ÿ** - ç§¯åˆ†è·å–ã€æ¶ˆè´¹ã€è½¬è´¦ã€ç»Ÿè®¡
- **å•†å“ç®¡ç†** - å•†å“å±•ç¤ºã€åˆ†ç±»ã€åº“å­˜ç®¡ç†
- **è®¢å•å¤„ç†** - ä¸‹å•ã€æ”¯ä»˜ã€å‘è´§ã€é€€æ¬¾
- **ä¼˜æƒ åˆ¸ç³»ç»Ÿ** - ä¼˜æƒ åˆ¸å‘æ”¾ã€ä½¿ç”¨ã€ç®¡ç†
- **æ”¯ä»˜é›†æˆ** - æ”¯ä»˜å®ã€å¾®ä¿¡æ”¯ä»˜

### ğŸ”§ æŠ€æœ¯ç‰¹æ€§
- **RESTful API** - æ ‡å‡†åŒ–APIæ¥å£
- **JWTè®¤è¯** - å®‰å…¨çš„ç”¨æˆ·è®¤è¯
- **Redisç¼“å­˜** - é«˜æ€§èƒ½æ•°æ®ç¼“å­˜
- **æ–‡ä»¶ä¸Šä¼ ** - å›¾ç‰‡å’Œæ–‡æ¡£ä¸Šä¼ 
- **é™æµä¿æŠ¤** - APIè¯·æ±‚é¢‘ç‡é™åˆ¶
- **æ—¥å¿—è®°å½•** - å®Œæ•´çš„æ“ä½œæ—¥å¿—
- **é”™è¯¯å¤„ç†** - ç»Ÿä¸€çš„é”™è¯¯å¤„ç†æœºåˆ¶

## æŠ€æœ¯æ ˆ

- **è¿è¡Œç¯å¢ƒ**: Node.js 18+
- **Webæ¡†æ¶**: Express.js
- **æ•°æ®åº“**: PostgreSQL
- **ç¼“å­˜**: Redis
- **ORM**: Sequelize
- **è®¤è¯**: JWT
- **æ–‡æ¡£**: Swagger
- **æµ‹è¯•**: Jest
- **ä»£ç è§„èŒƒ**: ESLint + Prettier

## é¡¹ç›®ç»“æ„

```
points-mall/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ config/          # é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ controllers/     # æ§åˆ¶å™¨
â”‚   â”œâ”€â”€ middleware/      # ä¸­é—´ä»¶
â”‚   â”œâ”€â”€ models/          # æ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ routes/          # è·¯ç”±å®šä¹‰
â”‚   â”œâ”€â”€ services/        # ä¸šåŠ¡æœåŠ¡
â”‚   â”œâ”€â”€ utils/           # å·¥å…·å‡½æ•°
â”‚   â””â”€â”€ app.js          # åº”ç”¨å…¥å£
â”œâ”€â”€ tests/              # æµ‹è¯•æ–‡ä»¶
â”œâ”€â”€ uploads/            # ä¸Šä¼ æ–‡ä»¶
â”œâ”€â”€ logs/               # æ—¥å¿—æ–‡ä»¶
â”œâ”€â”€ docs/               # æ–‡æ¡£
â”œâ”€â”€ .env.example        # ç¯å¢ƒå˜é‡æ¨¡æ¿
â”œâ”€â”€ package.json        # é¡¹ç›®é…ç½®
â”œâ”€â”€ server.js           # æœåŠ¡å™¨å¯åŠ¨æ–‡ä»¶
â””â”€â”€ README.md           # é¡¹ç›®è¯´æ˜
```

## å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- Node.js >= 18.0.0
- PostgreSQL >= 12.0
- Redis >= 6.0
- npm >= 8.0.0

### å®‰è£…æ­¥éª¤

1. **å…‹éš†é¡¹ç›®**
```bash
git clone https://github.com/wedraw/points-mall-backend.git
cd points-mall-backend
```

2. **å®‰è£…ä¾èµ–**
```bash
npm install
```

3. **é…ç½®ç¯å¢ƒå˜é‡**
```bash
cp .env.example .env
# ç¼–è¾‘ .env æ–‡ä»¶ï¼Œé…ç½®æ•°æ®åº“å’ŒRedisè¿æ¥ä¿¡æ¯
```

4. **æ•°æ®åº“åˆå§‹åŒ–**
```bash
# åˆ›å»ºæ•°æ®åº“
createdb points_mall

# è¿è¡Œæ•°æ®åº“è¿ç§»
npm run db:migrate

# è¿è¡Œç§å­æ•°æ®ï¼ˆå¯é€‰ï¼‰
npm run db:seed
```

5. **å¯åŠ¨æœåŠ¡**
```bash
# å¼€å‘æ¨¡å¼
npm run dev

# ç”Ÿäº§æ¨¡å¼
npm start
```

6. **è®¿é—®æœåŠ¡**
- APIæœåŠ¡: http://localhost:3000
- APIæ–‡æ¡£: http://localhost:3000/api-docs
- å¥åº·æ£€æŸ¥: http://localhost:3000/health

## ç¯å¢ƒé…ç½®

### å¿…éœ€é…ç½®

```env
# æ•°æ®åº“é…ç½®
DB_HOST=localhost
DB_PORT=5432
DB_NAME=points_mall
DB_USER=postgres
DB_PASSWORD=your_password

# Redisé…ç½®
REDIS_HOST=localhost
REDIS_PORT=6379

# JWTå¯†é’¥
JWT_SECRET=your_jwt_secret_key
```

### å¯é€‰é…ç½®

è¯¦ç»†é…ç½®é€‰é¡¹è¯·å‚è€ƒ `.env.example` æ–‡ä»¶ã€‚

## APIæ–‡æ¡£

### è®¤è¯æ¥å£
- `POST /api/auth/login` - ç”¨æˆ·ç™»å½•
- `POST /api/auth/register` - ç”¨æˆ·æ³¨å†Œ
- `POST /api/auth/refresh` - åˆ·æ–°ä»¤ç‰Œ
- `POST /api/auth/logout` - ç”¨æˆ·ç™»å‡º

### ç”¨æˆ·æ¥å£
- `GET /api/users/profile` - è·å–ç”¨æˆ·ä¿¡æ¯
- `PUT /api/users/profile` - æ›´æ–°ç”¨æˆ·ä¿¡æ¯
- `GET /api/users/points` - è·å–ç”¨æˆ·ç§¯åˆ†
- `GET /api/users/orders` - è·å–ç”¨æˆ·è®¢å•

### ç§¯åˆ†æ¥å£
- `GET /api/points/account` - è·å–ç§¯åˆ†è´¦æˆ·
- `GET /api/points/transactions` - è·å–ç§¯åˆ†äº¤æ˜“è®°å½•
- `POST /api/points/transfer` - ç§¯åˆ†è½¬è´¦
- `GET /api/points/statistics` - ç§¯åˆ†ç»Ÿè®¡

### å•†å“æ¥å£
- `GET /api/products` - è·å–å•†å“åˆ—è¡¨
- `GET /api/products/:id` - è·å–å•†å“è¯¦æƒ…
- `GET /api/products/search` - æœç´¢å•†å“
- `GET /api/products/categories` - è·å–å•†å“åˆ†ç±»

### è®¢å•æ¥å£
- `POST /api/orders` - åˆ›å»ºè®¢å•
- `GET /api/orders` - è·å–è®¢å•åˆ—è¡¨
- `GET /api/orders/:id` - è·å–è®¢å•è¯¦æƒ…
- `PUT /api/orders/:id/pay` - æ”¯ä»˜è®¢å•
- `PUT /api/orders/:id/cancel` - å–æ¶ˆè®¢å•

### ä¼˜æƒ åˆ¸æ¥å£
- `GET /api/coupons` - è·å–å¯ç”¨ä¼˜æƒ åˆ¸
- `POST /api/coupons/:id/claim` - é¢†å–ä¼˜æƒ åˆ¸
- `GET /api/coupons/my` - è·å–æˆ‘çš„ä¼˜æƒ åˆ¸
- `POST /api/coupons/validate` - éªŒè¯ä¼˜æƒ åˆ¸

å®Œæ•´çš„APIæ–‡æ¡£è¯·è®¿é—®: http://localhost:3000/api-docs

## å¼€å‘æŒ‡å—

### ä»£ç è§„èŒƒ

é¡¹ç›®ä½¿ç”¨ESLintå’ŒPrettierè¿›è¡Œä»£ç è§„èŒƒæ£€æŸ¥ï¼š

```bash
# æ£€æŸ¥ä»£ç è§„èŒƒ
npm run lint

# è‡ªåŠ¨ä¿®å¤ä»£ç è§„èŒƒ
npm run lint:fix

# æ ¼å¼åŒ–ä»£ç 
npm run format
```

### æµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
npm test

# ç›‘å¬æ¨¡å¼è¿è¡Œæµ‹è¯•
npm run test:watch

# ç”Ÿæˆæµ‹è¯•è¦†ç›–ç‡æŠ¥å‘Š
npm run test:coverage
```

### æ•°æ®åº“æ“ä½œ

```bash
# åˆ›å»ºè¿ç§»æ–‡ä»¶
npm run db:migration:create -- --name create-users-table

# è¿è¡Œè¿ç§»
npm run db:migrate

# å›æ»šè¿ç§»
npm run db:migrate:undo

# åˆ›å»ºç§å­æ–‡ä»¶
npm run db:seed:create -- --name demo-users

# è¿è¡Œç§å­
npm run db:seed

# å›æ»šç§å­
npm run db:seed:undo
```

## éƒ¨ç½²

### Dockeréƒ¨ç½²

1. **æ„å»ºé•œåƒ**
```bash
npm run docker:build
```

2. **è¿è¡Œå®¹å™¨**
```bash
npm run docker:run
```

### PM2éƒ¨ç½²

1. **å®‰è£…PM2**
```bash
npm install -g pm2
```

2. **å¯åŠ¨æœåŠ¡**
```bash
npm run pm2:start
```

3. **ç®¡ç†æœåŠ¡**
```bash
# æŸ¥çœ‹çŠ¶æ€
pm2 status

# æŸ¥çœ‹æ—¥å¿—
npm run pm2:logs

# é‡å¯æœåŠ¡
npm run pm2:restart

# åœæ­¢æœåŠ¡
npm run pm2:stop
```

### ç”Ÿäº§ç¯å¢ƒé…ç½®

1. **ç¯å¢ƒå˜é‡**
```env
NODE_ENV=production
PORT=3000
DB_LOGGING=false
LOG_LEVEL=warn
```

2. **æ€§èƒ½ä¼˜åŒ–**
- å¯ç”¨é›†ç¾¤æ¨¡å¼
- é…ç½®è´Ÿè½½å‡è¡¡
- å¯ç”¨ç¼“å­˜
- ä¼˜åŒ–æ•°æ®åº“è¿æ¥æ± 

3. **å®‰å…¨é…ç½®**
- ä½¿ç”¨HTTPS
- é…ç½®é˜²ç«å¢™
- å¯ç”¨å®‰å…¨å¤´
- å®šæœŸæ›´æ–°ä¾èµ–

## ç›‘æ§å’Œæ—¥å¿—

### æ—¥å¿—é…ç½®

æ—¥å¿—æ–‡ä»¶ä½äº `logs/` ç›®å½•ï¼š
- `application.log` - åº”ç”¨æ—¥å¿—
- `error.log` - é”™è¯¯æ—¥å¿—
- `access.log` - è®¿é—®æ—¥å¿—

### å¥åº·æ£€æŸ¥

- **å¥åº·æ£€æŸ¥**: `GET /health`
- **å°±ç»ªæ£€æŸ¥**: `GET /ready`

### æ€§èƒ½ç›‘æ§

å»ºè®®é›†æˆä»¥ä¸‹ç›‘æ§å·¥å…·ï¼š
- **APM**: New Relic, DataDog
- **æ—¥å¿—**: ELK Stack, Fluentd
- **æŒ‡æ ‡**: Prometheus + Grafana

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **æ•°æ®åº“è¿æ¥å¤±è´¥**
   - æ£€æŸ¥æ•°æ®åº“æœåŠ¡æ˜¯å¦å¯åŠ¨
   - éªŒè¯è¿æ¥é…ç½®
   - æ£€æŸ¥ç½‘ç»œè¿æ¥

2. **Redisè¿æ¥å¤±è´¥**
   - æ£€æŸ¥RedisæœåŠ¡çŠ¶æ€
   - éªŒè¯Redisé…ç½®
   - æ£€æŸ¥é˜²ç«å¢™è®¾ç½®

3. **JWTä»¤ç‰Œé”™è¯¯**
   - æ£€æŸ¥JWTå¯†é’¥é…ç½®
   - éªŒè¯ä»¤ç‰Œæ ¼å¼
   - æ£€æŸ¥ä»¤ç‰Œè¿‡æœŸæ—¶é—´

4. **æ–‡ä»¶ä¸Šä¼ å¤±è´¥**
   - æ£€æŸ¥ä¸Šä¼ ç›®å½•æƒé™
   - éªŒè¯æ–‡ä»¶å¤§å°é™åˆ¶
   - æ£€æŸ¥æ–‡ä»¶ç±»å‹é™åˆ¶

### è°ƒè¯•æ¨¡å¼

```bash
# å¯ç”¨è°ƒè¯•æ¨¡å¼
DEBUG=points-mall:* npm run dev

# å¯ç”¨æ€§èƒ½åˆ†æ
PROFILE_ENABLED=true npm run dev
```

## è´¡çŒ®æŒ‡å—

1. Forké¡¹ç›®
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯ (`git checkout -b feature/amazing-feature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some amazing feature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/amazing-feature`)
5. åˆ›å»ºPull Request

### æäº¤è§„èŒƒ

ä½¿ç”¨çº¦å®šå¼æäº¤æ ¼å¼ï¼š

```
type(scope): description

[optional body]

[optional footer]
```

ç±»å‹è¯´æ˜ï¼š
- `feat`: æ–°åŠŸèƒ½
- `fix`: ä¿®å¤bug
- `docs`: æ–‡æ¡£æ›´æ–°
- `style`: ä»£ç æ ¼å¼
- `refactor`: ä»£ç é‡æ„
- `test`: æµ‹è¯•ç›¸å…³
- `chore`: æ„å»ºè¿‡ç¨‹æˆ–è¾…åŠ©å·¥å…·çš„å˜åŠ¨

## è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ [MIT](LICENSE) è®¸å¯è¯ã€‚

## è”ç³»æˆ‘ä»¬

- **é¡¹ç›®ä¸»é¡µ**: https://github.com/wedraw/points-mall-backend
- **é—®é¢˜åé¦ˆ**: https://github.com/wedraw/points-mall-backend/issues
- **é‚®ç®±**: support@wedraw.com
- **å®˜ç½‘**: https://wedraw.com

## æ›´æ–°æ—¥å¿—

### v1.0.0 (2024-01-01)
- ğŸ‰ åˆå§‹ç‰ˆæœ¬å‘å¸ƒ
- âœ¨ å®Œæ•´çš„ç§¯åˆ†å•†åŸåŠŸèƒ½
- ğŸ” JWTè®¤è¯ç³»ç»Ÿ
- ğŸ’³ æ”¯ä»˜ç³»ç»Ÿé›†æˆ
- ğŸ“ å®Œæ•´çš„APIæ–‡æ¡£
- ğŸ§ª å•å…ƒæµ‹è¯•è¦†ç›–
- ğŸ³ Dockeræ”¯æŒ
- ğŸ“Š ç›‘æ§å’Œæ—¥å¿—ç³»ç»Ÿ

---

**æ„Ÿè°¢ä½¿ç”¨WeDrawç§¯åˆ†å•†åŸï¼** ğŸ‰